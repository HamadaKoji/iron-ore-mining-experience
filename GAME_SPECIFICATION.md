# 生産密度チャレンジ - ゲーム仕様書

## 概要
限られた資源で最高効率の工場を作り、生産密度スコアを競うシミュレーションゲーム。プレイヤーは採掘機、ベルトコンベア、製錬炉を使って効率的な生産ラインを構築し、ベストスコアの更新を目指す。

## 基本仕様

### ゲーム画面
- **マップサイズ**: 20x23のグリッド
- **セルサイズ**: 26x26ピクセル
- **キャンバスサイズ**: 520x598ピクセル
- **技術構成**: HTML5 Canvas + JavaScript ES6モジュール（外部ライブラリなし）
- **レイアウト**: 3カラムレイアウト（統計パネル + ゲーム画面 + ガイドパネル）

### 地形システム
- **草地**: 緑色の背景、建物設置可能
- **鉄鉱石エリア**: 茶色（濃い茶）の背景、採掘機設置可能（固定25個）
- **銅鉱石エリア**: 橙色（薄い茶）の背景、採掘機設置可能（固定20個）
- **石炭エリア**: 黒色（濃い灰色）の背景、採掘機設置可能（固定15個）
- **地形生成**: クラスター状配置（5-9個のまとまり）、公平性のため数は固定

## 資源システム

### 1. 鉄鉱石 (🔩)
- **採掘場所**: 鉄鉱石エリア（濃い茶色）
- **アイテム表示**: 🔩 + 白背景 + オレンジ境界線
- **用途**: 製錬炉で鉄板に加工

### 2. 銅鉱石 (🟠)
- **採掘場所**: 銅鉱石エリア（薄い茶色）
- **アイテム表示**: 🟠 + 白背景 + 茶色境界線
- **用途**: 製錬炉で銅板に加工

### 3. 石炭 (⚫)
- **採掘場所**: 石炭エリア（濃い灰色）
- **アイテム表示**: ⚫ + 白背景 + 濃いグレー境界線
- **用途**: 製錬炉の燃料

### 4. 鉄板 (🟦)
- **生産方法**: 製錬炉で鉄鉱石+石炭から生成
- **アイテム表示**: 🟦 + 白背景 + 青色境界線
- **価値**: 最終製品

### 5. 銅板 (🟧)
- **生産方法**: 製錬炉で銅鉱石+石炭から生成
- **アイテム表示**: 🟧 + 白背景 + オレンジ色境界線
- **価値**: 最終製品

## 建物システム

### 1. 採掘機 (⛏️)
- **設置条件**: 任意の資源エリア（鉄鉱石、銅鉱石、石炭）
- **機能**: 設置された資源エリアに応じた資源を自動採掘
- **採掘速度**: 2秒に1個（全資源共通）
- **出力**: 設置場所に応じた資源アイテム
- **表示**: 灰色背景 + ⛏️絵文字
- **アイテム出力**: 隣接するベルトの方向を確認し、適切な方向のベルトに出力
  - 右側のベルト: 右向き(➡️)で受け取り
  - 下側のベルト: 下向き(⬇️)で受け取り
  - 左側のベルト: 左向き(⬅️)で受け取り
  - 上側のベルト: 上向き(⬆️)で受け取り

### 2. ベルトコンベア
- **設置条件**: 任意の場所
- **機能**: アイテムを指定方向に運搬（全資源タイプ対応）
- **運搬方向**: 
  - 右 (➡️)
  - 下 (⬇️)
  - 左 (⬅️)
  - 上 (⬆️)
- **運搬速度**: 0.5秒に1マス移動
- **表示**: 青色背景 + 方向別絵文字
- **方向選択**: ツールバーの方向ボタンで設置前に選択

### 3. 製錬炉 (🔥)
- **設置条件**: 草地のみ（資源エリアには設置不可）
- **機能**: 鉱石を金属板に加工
- **入力**:
  - 鉄鉱石 + 石炭 → 鉄板
  - 銅鉱石 + 石炭 → 銅板
- **製錬時間**: 4秒/個
- **表示**: オレンジ色背景 + 🔥絵文字
- **状態表示**:
  - 製錬中: 進行バー表示
  - 燃料切れ: グレーアウト表示
- **バッファ**: 鉱石1個、石炭1個、完成品1個まで保持
- **連続生産**: 材料があれば自動的に次の製錬を開始
- **アイテム出力**: 隣接するベルトに自動出力（全方向対応）

## スコアリングシステム

### 生産密度スコア
- **計算式**: スコア = 金属板生産量 × 稼働効率
- **稼働効率**: (稼働中の採掘機数 × 稼働中の製錬炉数) ÷ 総建物数
- **目的**: 大規模で効率的な工場を作るほど高スコア
- **ベストスコア**: ローカルストレージに永続保存

### スコア要素
1. **金属板生産量**: 鉄板と銅板の合計生産レート（個/分）
2. **稼働中の採掘機**: 実際に資源を生産している採掘機の数
3. **稼働中の製錬炉**: 製錬中または出力待ちの製錬炉の数
4. **総建物数**: 採掘機 + ベルト + 製錬炉の合計

## UI/UXシステム

### メインレイアウト
- **ヘッダー**: タイトル + ツールバー
- **ゲーム画面**: 520x598px、中央メインエリア
- **統計パネル**: 280px幅、左側統計情報
- **ガイドパネル**: 350px幅、右側操作ガイド

### 統計パネル
1. **生産統計**: 8つの統計カード
   - 各資源の保有数と生産レート
   - 各建物の設置数と稼働率

2. **効率レポート**:
   - 生産密度スコア（リアルタイム更新）
   - 総金属板生産量
   - 稼働効率の詳細
   - 効率推移グラフ（5分間の履歴）

3. **最大効率記録**:
   - ベストスコア表示
   - 達成日時
   - 詳細情報（生産量、稼働効率など）

### ガイドパネル
1. **操作ガイド**: 左/右クリックの説明
2. **資源エリアガイド**: 各資源の色と用途
3. **基本手順**: 3ステップのチュートリアル
4. **ゲームの目的**: スコア計算式とヒント

### ヒントシステム
- **動的ヒント**: プレイ進行に応じて表示
- **初回**: 資源エリアに採掘機を設置
- **第2段階**: ベルトで運搬ライン構築
- **第3段階**: 製錬炉で金属板を生産
- **完成**: 工場稼働中の効率改善提案

## ゲームメカニクス

### アイテムフロー
1. **採掘**: 採掘機が資源エリアから対応する資源を生成
2. **運搬**: ベルトが指定方向にアイテムを移動
3. **加工**: 製錬炉が鉱石と石炭から金属板を生成
4. **継続**: 金属板を更にベルトで運搬（スコア計算に反映）

### 建物配置ルール
- **採掘機**: 資源エリアのみ設置可能
- **製錬炉**: 草地のみ設置可能
- **ベルト**: 任意の場所に設置可能
- **重複禁止**: 同じマスに複数の建物は設置不可

### リセット機能
- **リセットボタン**: ツールバー右端
- **リセット内容**:
  - 全建物の削除
  - 全アイテムの削除
  - 統計のクリア
- **保持される内容**: ベストスコア記録

## 技術仕様

### アーキテクチャ
- **モジュラー設計**: ES6モジュールによる機能分割
- **主要モジュール**:
  - `config.js`: ゲーム設定・定数
  - `terrain.js`: 地形生成・管理（クラスター配置）
  - `buildings.js`: 建物配置・管理
  - `items.js`: アイテム移動・管理
  - `renderer.js`: 描画処理
  - `game.js`: メインゲームループ・スコア計算
  - `efficiency-chart.js`: 効率グラフ描画

### パフォーマンス
- **フレームレート**: 60fps目標
- **更新頻度**: 
  - 採掘: 2秒間隔（120フレーム）
  - アイテム移動: 0.5秒間隔（30フレーム）
  - 統計更新: 1秒間隔
  - 効率計算: 10秒間隔

## バランス設定

### 資源配置（固定）
- **鉄鉱石**: 25個（クラスター配置）
- **銅鉱石**: 20個（クラスター配置）
- **石炭**: 15個（クラスター配置）
- **草地**: 残り400個

### 生産効率
- **採掘速度**: 全資源2秒/個（統一）
- **運搬速度**: 0.5秒/マス
- **製錬時間**: 4秒/個
- **最適効率**: 複数ラインの並列稼働で実現

## 勝利条件とゲーム目標
- **明確な勝利条件**: なし（サンドボックス型）
- **主要目標**: 生産密度スコアの最大化
- **副次目標**: 
  - 効率的な工場レイアウトの設計
  - 資源の無駄のない活用
  - ベストスコアの更新

---

**最終更新**: 2025年1月6日  
**バージョン**: 3.0（生産密度システム・クラスター配置対応）  
**対象**: 工場設計と効率化を楽しむ全てのプレイヤー